{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "Pathfinder 2e Architect Data Structure",
  "type": "object",
  "required": ["title", "chapters"],
  "properties": {
    "title": {
      "type": "string",
      "description": "The main title of the book or document."
    },
    "chapters": {
      "type": "array",
      "items": {
        "type": "object",
        "required": ["id", "title", "content"],
        "properties": {
          "id": { "type": "string" },
          "title": { "type": "string" },
          "content": {
            "type": "array",
            "items": {
              "$ref": "#/definitions/contentBlock"
            }
          }
        }
      }
    }
  },
  "definitions": {
    "contentBlock": {
      "oneOf": [
        { "$ref": "#/definitions/headingBlock" },
        { "$ref": "#/definitions/paragraphBlock" },
        { "$ref": "#/definitions/introBlock" },
        { "$ref": "#/definitions/creatureBlock" },
        { "$ref": "#/definitions/spellBlock" },
        { "$ref": "#/definitions/itemBlock" },
        { "$ref": "#/definitions/featBlock" },
        { "$ref": "#/definitions/deityBlock" },
        { "$ref": "#/definitions/inventoryBlock" },
        { "$ref": "#/definitions/afflictionBlock" },
        { "$ref": "#/definitions/hazardBlock" },
        { "$ref": "#/definitions/xpBlock" },
        { "$ref": "#/definitions/areaBlock" },
        { "$ref": "#/definitions/imageBlock" },
        { "$ref": "#/definitions/readAloudBlock" },
        { "$ref": "#/definitions/sidebarBlock" },
        { "$ref": "#/definitions/tableBlock" }
      ]
    },
    "headingBlock": {
      "type": "object",
      "required": ["type", "text"],
      "properties": {
        "type": { "const": "heading" },
        "text": { "type": "string" }
      }
    },
    "paragraphBlock": {
      "type": "object",
      "required": ["type", "text"],
      "properties": {
        "type": { "const": "paragraph" },
        "text": { "type": "string", "description": "Supports markdown-like syntax: **bold** and [action] icons." }
      }
    },
    "introBlock": {
      "type": "object",
      "required": ["type", "text"],
      "properties": {
        "type": { "const": "intro" },
        "text": { "type": "string" }
      }
    },
    "creatureBlock": {
      "type": "object",
      "required": ["type", "data"],
      "properties": {
        "type": { "const": "creature" },
        "data": {
          "type": "object",
          "required": ["name", "level", "defense"],
          "properties": {
            "name": { "type": "string" },
            "level": { "type": "number" },
            "traits": { "type": "array", "items": { "type": "string" } },
            "rarity": { "type": "string" },
            "size": { "type": "string" },
            "alignment": { "type": "string" },
            "perception": { "type": "number" },
            "senses": { "type": "string" },
            "languages": { "type": "array", "items": { "type": "string" } },
            "skills": { 
              "type": "object",
              "additionalProperties": { "type": "number" }
            },
            "items": { "type": "array", "items": { "type": "string" } },
            "abilities": {
              "type": "object",
              "properties": {
                "str": { "type": "number" },
                "dex": { "type": "number" },
                "con": { "type": "number" },
                "int": { "type": "number" },
                "wis": { "type": "number" },
                "cha": { "type": "number" }
              }
            },
            "defense": {
              "type": "object",
              "required": ["ac", "hp"],
              "properties": {
                "ac": { "type": "number" },
                "fort": { "type": "number" },
                "ref": { "type": "number" },
                "will": { "type": "number" },
                "hp": { "type": "number" },
                "regeneration": { "type": "string" },
                "immunities": { "type": "array", "items": { "type": "string" } },
                "weaknesses": { 
                  "type": "array", 
                  "items": { "type": "object", "properties": { "type": { "type": "string" }, "value": { "type": "number" } } } 
                },
                "resistances": { 
                  "type": "array", 
                  "items": { "type": "object", "properties": { "type": { "type": "string" }, "value": { "type": "number" } } } 
                }
              }
            },
            "speed": { "type": "string" },
            "strikes": {
              "type": "array",
              "items": {
                "type": "object",
                "properties": {
                  "name": { "type": "string" },
                  "actions": { "type": "string", "enum": ["1", "2", "3", "r", "f", "reaction", "free"] },
                  "bonus": { "type": "number" },
                  "traits": { "type": "array", "items": { "type": "string" } },
                  "damage": { "type": "string" }
                }
              }
            },
            "spellcasting": {
              "type": "array",
              "items": {
                "type": "object",
                "properties": {
                  "name": { "type": "string" },
                  "dc": { "type": "number" },
                  "attack": { "type": "number" },
                  "slots": {
                    "type": "object",
                    "additionalProperties": { "type": "array", "items": { "type": "string" } }
                  }
                }
              }
            },
            "specials": {
              "type": "array",
              "items": {
                "type": "object",
                "properties": {
                  "name": { "type": "string" },
                  "actions": { "type": "string" },
                  "traits": { "type": "array", "items": { "type": "string" } },
                  "text": { "type": "string" }
                }
              }
            }
          }
        }
      }
    },
    "spellBlock": {
      "type": "object",
      "required": ["type", "data"],
      "properties": {
        "type": { "const": "spell" },
        "data": {
          "type": "object",
          "required": ["name", "level", "description"],
          "properties": {
            "name": { "type": "string" },
            "type": { "type": "string", "description": "Can be 'Spell' or 'Ritual'" },
            "level": { "type": "number" },
            "traits": { "type": "array", "items": { "type": "string" } },
            "traditions": { "type": "array", "items": { "type": "string" } },
            "cast": {
              "type": "object",
              "properties": {
                "actions": { "type": "string" },
                "components": { "type": "array", "items": { "type": "string" } }
              }
            },
            "cost": { "type": "string" },
            "primary_check": { "type": "string", "description": "For Rituals" },
            "secondary_check": { "type": "string", "description": "For Rituals" },
            "secondary_casters": { "type": "string", "description": "For Rituals" },
            "range": { "type": "string" },
            "area": { "type": "string" },
            "target": { "type": "string" },
            "duration": { "type": "string" },
            "save": { "type": "string" },
            "description": { "type": "string" },
            "heightened": {
              "type": "array",
              "items": {
                "type": "object",
                "properties": {
                  "trigger": { "type": "string" },
                  "text": { "type": "string" }
                }
              }
            }
          }
        }
      }
    },
    "featBlock": {
      "type": "object",
      "required": ["type", "data"],
      "properties": {
        "type": { "const": "feat" },
        "data": {
          "type": "object",
          "required": ["name", "level", "description"],
          "properties": {
            "name": { "type": "string" },
            "level": { "type": "number" },
            "traits": { "type": "array", "items": { "type": "string" } },
            "actions": { "type": "string" },
            "description": { "type": "string" },
            "prerequisites": { "type": "string" },
            "frequency": { "type": "string" },
            "trigger": { "type": "string" },
            "requirements": { "type": "string" },
            "cost": { "type": "string" }
          }
        }
      }
    },
    "itemBlock": {
      "type": "object",
      "required": ["type", "data"],
      "properties": {
        "type": { "const": "item" },
        "data": {
          "type": "object",
          "required": ["name"],
          "properties": {
            "name": { "type": "string" },
            "level": { "type": "number" },
            "traits": { "type": "array", "items": { "type": "string" } },
            "price": { "type": "string" },
            "bulk": { "type": "string" },
            "usage": { "type": "string" },
            "description": { "type": "string" },
            
            "damage": { "type": "string" },
            "hands": { "type": "string" },
            "range": { "type": "string" },
            "reload": { "type": "string" },
            "category": { "type": "string" },
            "group": { "type": "string" },
            
            "ac_bonus": { "type": "string" },
            "dex_cap": { "type": "string" },
            "check_penalty": { "type": "string" },
            "speed_penalty": { "type": "string" },
            "strength": { "type": "string" },
            
            "hardness": { "type": "string" },
            "hp": { "type": "string" },
            "bt": { "type": "string" },
            
            "speed": { "type": "string" },
            "crew": { "type": "string" },
            "passengers": { "type": "string" },
            "piloting_check": { "type": "string" },
            "collision_damage": { "type": "string" },
            "ac": { "type": "string" },
            
            "onset": { "type": "string" },
            "duration": { "type": "string" },
            "saving_throw": { "type": "string" },
            "stages": {
              "type": "array",
              "items": {
                "type": "object",
                "properties": {
                  "stage": { "type": "number" },
                  "text": { "type": "string" }
                }
              }
            },
            
            "activate": { "type": "string" },
            "frequency": { "type": "string" },
            "trigger": { "type": "string" },
            "requirements": { "type": "string" },
            
            "craft_requirements": { "type": "string" }
          }
        }
      }
    },
    "deityBlock": {
      "type": "object",
      "required": ["type", "data"],
      "properties": {
        "type": { "const": "deity" },
        "data": {
          "type": "object",
          "required": ["name"],
          "properties": {
            "name": { "type": "string" },
            "alignment": { "type": "string" },
            "title": { "type": "string" },
            "edicts": { "type": "array", "items": { "type": "string" } },
            "anathema": { "type": "array", "items": { "type": "string" } },
            "font": { "type": "array", "items": { "type": "string" } },
            "skill": { "type": "string" },
            "weapon": { "type": "string" },
            "domains": { "type": "array", "items": { "type": "string" } },
            "cleric_spells": { "type": "array", "items": { "type": "string" } }
          }
        }
      }
    },
    "inventoryBlock": {
      "type": "object",
      "required": ["type", "items"],
      "properties": {
        "type": { "const": "inventory" },
        "title": { "type": "string" },
        "currency": { "type": "string" },
        "items": {
          "type": "array",
          "items": {
            "type": "object",
            "properties": {
              "name": { "type": "string" },
              "price": { "type": "string" },
              "bulk": { "type": "string" }
            }
          }
        }
      }
    },
    "afflictionBlock": {
      "type": "object",
      "required": ["type", "data"],
      "properties": {
        "type": { "const": "affliction" },
        "data": {
          "type": "object",
          "required": ["name"],
          "properties": {
            "name": { "type": "string" },
            "type": { "type": "string", "default": "Affliction" },
            "level": { "type": "number" },
            "traits": { "type": "array", "items": { "type": "string" } },
            "onset": { "type": "string" },
            "save": { "type": "string" },
            "duration": { "type": "string" },
            "stages": {
              "type": "array",
              "items": {
                "type": "object",
                "properties": {
                  "stage": { "type": "number" },
                  "text": { "type": "string" }
                }
              }
            }
          }
        }
      }
    },
    "hazardBlock": {
      "type": "object",
      "required": ["type", "data"],
      "properties": {
        "type": { "const": "hazard" },
        "data": {
          "type": "object",
          "required": ["name", "stealth", "disable"],
          "properties": {
            "name": { "type": "string" },
            "type": { "type": "string", "default": "Hazard" },
            "level": { "type": "number" },
            "traits": { "type": "array", "items": { "type": "string" } },
            "stealth": { "type": "string" },
            "disable": { "type": "string" },
            "description": { "type": "string" },
            "ac": { "type": ["string", "number"] },
            "fort": { "type": ["string", "number"] },
            "ref": { "type": ["string", "number"] },
            "hp": { "type": ["string", "number"] },
            "hardness": { "type": ["string", "number"] },
            "routine": { "type": "string" },
            "reset": { "type": "string" }
          }
        }
      }
    },
    "xpBlock": {
      "type": "object",
      "required": ["type", "amount"],
      "properties": {
        "type": { "const": "xp" },
        "amount": { "type": "number" },
        "text": { "type": "string" }
      }
    },
    "areaBlock": {
      "type": "object",
      "required": ["type", "id", "name"],
      "properties": {
        "type": { "const": "area" },
        "id": { "type": "string" },
        "name": { "type": "string" },
        "severity": { "type": "string", "enum": ["Low", "Moderate", "Severe", "Extreme"] }
      }
    },
    "imageBlock": {
      "type": "object",
      "required": ["type", "src"],
      "properties": {
        "type": { "const": "image" },
        "src": { "type": "string" },
        "caption": { "type": "string" },
        "fullWidth": { "type": "boolean" }
      }
    },
    "readAloudBlock": {
      "type": "object",
      "required": ["type", "text"],
      "properties": {
        "type": { "const": "box" },
        "title": { "type": "string" },
        "text": { "type": "string" }
      }
    },
    "sidebarBlock": {
      "type": "object",
      "required": ["type", "title", "text"],
      "properties": {
        "type": { "const": "sidebar" },
        "title": { "type": "string" },
        "text": { "type": "string" }
      }
    },
    "tableBlock": {
      "type": "object",
      "required": ["type", "headers", "rows"],
      "properties": {
        "type": { "const": "table" },
        "headers": { "type": "array", "items": { "type": "string" } },
        "rows": { 
          "type": "array", 
          "items": { "type": "array", "items": { "type": "string" } } 
        }
      }
    }
  }
}